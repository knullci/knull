name: Knull Java CI/CD Build Pipeline

steps:
    - name: Compile Java Sources
      run:
        tool: docker
        args: ["build", "--target", "compile", "-t", "knull-ci-cd:compile", "."]

    - name: Run Tests
      run:
        tool: docker
        args: ["build", "--target", "test", "-t", "knull-ci-cd:test", "."]

    - name: Package Application
      run:
        tool: docker
        args: ["build", "--target", "package", "-t", "knull-ci-cd:package", "."]

    - name: Build Production Image
      run:
        tool: docker
        args: ["build", "--target", "production", "-t", "knull-ci-cd:latest", "."]

    - name: Cleanup Build Images
      run:
        tool: docker
        args: ["rmi", "knull-ci-cd:compile", "knull-ci-cd:test", "knull-ci-cd:package"]

    - name: Cleanup Old Images
      run:
        tool: docker
        args: ["image", "prune", "-f", "--filter", "until=24h"]
